<!DOCTYPE html>

<html>
<head>
  <title>narrative.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>narrative.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>System.register([<span class="hljs-string">'reflect-metadata'</span>, <span class="hljs-string">'angular2/core'</span>, <span class="hljs-string">'angular2/platform/browser'</span>, <span class="hljs-string">'./components/producer-component.js'</span>, <span class="hljs-string">'./mf-config.js'</span>, <span class="hljs-string">'./services/g-service.js'</span>, <span class="hljs-string">'./services/p-service.js'</span>, <span class="hljs-string">'./services/l-service.js'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">exports_1, context_1</span>) </span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">var</span> __moduleName = context_1 &amp;&amp; context_1.id;
    <span class="hljs-keyword">var</span> __decorate = (<span class="hljs-keyword">this</span> &amp;&amp; <span class="hljs-keyword">this</span>.__decorate) || <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">decorators, target, key, desc</span>) </span>{
        <span class="hljs-keyword">var</span> c = <span class="hljs-built_in">arguments</span>.length, r = c &lt; <span class="hljs-number">3</span> ? target : desc === <span class="hljs-literal">null</span> ? desc = <span class="hljs-built_in">Object</span>.getOwnPropertyDescriptor(target, key) : desc, d;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">Reflect</span> === <span class="hljs-string">"object"</span> &amp;&amp; <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">Reflect</span>.decorate === <span class="hljs-string">"function"</span>) r = <span class="hljs-built_in">Reflect</span>.decorate(decorators, target, key, desc);
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = decorators.length - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) <span class="hljs-keyword">if</span> (d = decorators[i]) r = (c &lt; <span class="hljs-number">3</span> ? d(r) : c &gt; <span class="hljs-number">3</span> ? d(target, key, r) : d(target, key)) || r;
        <span class="hljs-keyword">return</span> c &gt; <span class="hljs-number">3</span> &amp;&amp; r &amp;&amp; <span class="hljs-built_in">Object</span>.defineProperty(target, key, r), r;
    };
    <span class="hljs-keyword">var</span> __metadata = (<span class="hljs-keyword">this</span> &amp;&amp; <span class="hljs-keyword">this</span>.__metadata) || <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">k, v</span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">Reflect</span> === <span class="hljs-string">"object"</span> &amp;&amp; <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">Reflect</span>.metadata === <span class="hljs-string">"function"</span>) <span class="hljs-keyword">return</span> <span class="hljs-built_in">Reflect</span>.metadata(k, v);
    };
    <span class="hljs-keyword">var</span> __param = (<span class="hljs-keyword">this</span> &amp;&amp; <span class="hljs-keyword">this</span>.__param) || <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">paramIndex, decorator</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">target, key</span>) </span>{ decorator(target, key, paramIndex); }
    };
    <span class="hljs-keyword">var</span> core_1, browser_1, producer_component_js_1, mf_config_js_1, g_service_js_1, p_service_js_1, l_service_js_1;
    <span class="hljs-keyword">var</span> Narrative;
    <span class="hljs-keyword">return</span> {
        setters:[
            <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">_1</span>) </span>{},
            <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">core_1_1</span>) </span>{
                core_1 = core_1_1;
            },
            <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">browser_1_1</span>) </span>{
                browser_1 = browser_1_1;
            },
            <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">producer_component_js_1_1</span>) </span>{
                producer_component_js_1 = producer_component_js_1_1;
            },
            <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">mf_config_js_1_1</span>) </span>{
                mf_config_js_1 = mf_config_js_1_1;
            },
            <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">g_service_js_1_1</span>) </span>{
                g_service_js_1 = g_service_js_1_1;
            },
            <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">p_service_js_1_1</span>) </span>{
                p_service_js_1 = p_service_js_1_1;
            },
            <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">l_service_js_1_1</span>) </span>{
                l_service_js_1 = l_service_js_1_1;
            }],
        execute: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            Narrative = (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Narrative</span>(<span class="hljs-params">config</span>) </span>{
                    <span class="hljs-keyword">this</span>.name = <span class="hljs-string">'foo'</span>;
                    <span class="hljs-keyword">this</span>.config = config;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>create a Producer</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">this</span>.producer = <span class="hljs-keyword">new</span> producer_component_js_1.Producer(config, g_service_js_1.G, p_service_js_1.P, l_service_js_1.L);
                }
                Narrative.prototype.getConfig = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.config;
                };
                Narrative.prototype.cycle = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">period, cbg, cbp</span>) </span>{
                    <span class="hljs-keyword">var</span> _this = <span class="hljs-keyword">this</span>;
                    <span class="hljs-keyword">var</span> axiom1 = { axiom: [<span class="hljs-number">2</span>, <span class="hljs-number">4</span>],
                        g_rule: <span class="hljs-string">'+'</span>,
                        p_rule: <span class="hljs-number">.5</span> }, axiom2 = { axiom: [<span class="hljs-number">10</span>, <span class="hljs-number">7</span>],
                        g_rule: <span class="hljs-string">'*'</span>,
                        p_rule: <span class="hljs-number">2.0</span> }, msg;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>set callbacks if they have been passed in as cycle-args</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (cbg) {
                        <span class="hljs-keyword">this</span>.producer.callbackG(cbg);
                    }
                    ;
                    <span class="hljs-keyword">if</span> (cbp) {
                        <span class="hljs-keyword">this</span>.producer.callbackP(cbp);
                    }
                    ;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>webkit axiom-production cycle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    setInterval(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                        msg = (<span class="hljs-built_in">Math</span>.random() &lt; <span class="hljs-number">.5</span>) ? axiom1 : axiom2;
                        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"\n\n@@@ ****** producer sent to genotype-proxy msg = "</span> + msg);
                        _this.producer.emitG(msg).then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">o</span>) </span>{
                            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"narrative received resolvedG-genotype "</span> + o.genotype);
                            _this.producer.emitP(o).then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">o</span>) </span>{
                                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"narrative received resolvedP-phenotype "</span> + o.phenotype);
                            })
                                .catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
                                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"producer.emitP("</span> + o + <span class="hljs-string">") returned rejectP-error: "</span> + e);
                            });
                        })
                            .catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
                            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"producer.emitG("</span> + msg + <span class="hljs-string">") returned rejectG-error: "</span> + e);
                        });
                    }, period);
                };
                Narrative = __decorate([
                    core_1.Component({
                        selector: <span class="hljs-string">'narrative'</span>,
                        providers: [
                            core_1.provide(mf_config_js_1.MF_CONFIG, { useValue: mf_config_js_1.CONFIG })
                        ]
                    }),
                    core_1.View({
                        template: <span class="hljs-string">'&lt;input [value]="name" (keyup)="name = $event.target.value"/&gt;My name is {{name}}'</span>
                    }),
                    core_1.Injectable(),
                    __param(<span class="hljs-number">0</span>, core_1.Inject(mf_config_js_1.MF_CONFIG)), 
                    __metadata(<span class="hljs-string">'design:paramtypes'</span>, [(<span class="hljs-keyword">typeof</span> (_a = <span class="hljs-keyword">typeof</span> mf_config_js_1.Config !== <span class="hljs-string">'undefined'</span> &amp;&amp; mf_config_js_1.Config) === <span class="hljs-string">'function'</span> &amp;&amp; _a) || <span class="hljs-built_in">Object</span>])
                ], Narrative);
                <span class="hljs-keyword">return</span> Narrative;
                <span class="hljs-keyword">var</span> _a;
            }());
            exports_1(<span class="hljs-string">"Narrative"</span>, Narrative);</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>bootstrap returns Promise whose resolve returns a ComponentRef
with property ‘instance’ - the instance of class Narrative
Therefore the Promise returned by Narrative[‘instance’] resolves
to the bootstrapped instance of class Narrative, the single property
of Module narrative-component</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            browser_1.bootstrap(Narrative).then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">component</span>) </span>{
                <span class="hljs-keyword">var</span> narrative = component.instance, cfg = narrative.getConfig(), test, p;
                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"@@@@@@@@ bootstrap resolves to componentRef = "</span> + component);
                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"@@@@@@@@ cfg = "</span> + cfg);
                <span class="hljs-keyword">for</span> (p <span class="hljs-keyword">in</span> cfg) {
                    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"@@@@@@@@ cfg has property "</span> + p);
                }
                <span class="hljs-keyword">for</span> (p <span class="hljs-keyword">in</span> narrative) {
                    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"@@@@@@@@ narrative has property "</span> + p);
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>start producer cycle of axiom-&gt;genotype-&gt;phenotype </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                test = narrative.getConfig()[<span class="hljs-string">'test'</span>];
                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"narrative.getConfig()['test'] = "</span> + narrative.getConfig()[<span class="hljs-string">'test'</span>]);
                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"test = "</span> + test);
                <span class="hljs-keyword">if</span> (test === <span class="hljs-literal">false</span>) {
                    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"narrative.cycle period = "</span> + cfg.period);
                    component.instance.cycle(cfg.period, cfg.cbg, cfg.cbp);
                }
            });
        }
    }
});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
